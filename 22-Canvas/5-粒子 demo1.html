<html>
<head>
  <title>5-粒子 demo1</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/304720 (zh-CN, DDL); Windows/10.0.14393 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="609"/>
<h1>5-粒子 demo1</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/4/20 星期四 15:04</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2017/4/20 星期四 15:04</i></td></tr>
<tr><td><b>作者：</b></td><td><i>王平安</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div><h1 style="margin: 10px auto; padding: 0px 0px 10px 20px; font-size: 24px; font-weight: bold; width: 740px; min-height: 25px; border-bottom: 1px dashed rgb(1, 152, 117); float: left; box-sizing: border-box; display: table; color: rgb(1, 152, 117); transition: all 1s ease 0s; font-family: Helvetica, Verdana, Arial, sans-serif; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"><a href="http://www.cnblogs.com/Naomi-love/p/6022193.html" style="margin: 0px; padding: 0px; color: rgb(1, 152, 117); text-decoration: none;">打造高大上的Canvas粒子(一)</a></h1><div style="margin: 0px; padding: 5px 2px 5px 5px; font-style: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><div style="margin: 0px 0px 20px; padding: 0px; word-break: break-word;"><h1 style="margin: 10px 0px; padding: 0px; font-size: 28px; font-weight: bold;"><span style="font-family: Helvetica, Verdana, Arial, sans-serif;">HTML5 <span style="margin: 0px; padding: 0px;">Canvas</span></span></h1><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="font-size: 14px;"><span style="font-family: Helvetica, Verdana, Arial, sans-serif;"><span style="margin: 0px; padding: 0px;">&lt;canvas&gt;标签定义图形，比如图表和其他图像，必须用脚本（javascript）绘制图形.</span></span></span></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="font-size: 14px;"><span style="font-family: Helvetica, Verdana, Arial, sans-serif;"><span style="margin: 0px; padding: 0px;">举例：绘制矩形</span></span></span></p><div style="margin: 5px 0px; padding: 5px; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); overflow: auto; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot; !important; font-size: 12px !important;"><pre style="margin: 0px; padding: 0px; white-space: pre-wrap; word-wrap: break-word; font-family: &quot;Courier New&quot; !important; font-size: 12px !important;">
&lt;script&gt;
<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">var</span> c = document.getElementById(&quot;myCanvas&quot;<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">);
</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">var</span> ctx = c.getContext(&quot;2d&quot;<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">);  //找到canvas元素
ctx.fillStyle </span>= &quot;#FF0000&quot;<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">;    //创建context对象
ctx.fillRect(</span>0,0,150,75<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">); <br style="margin: 0px; padding: 0px;"/> //</span>getContext(&quot;2d&quot;) 对象是内建的 HTML5 对象，拥有多种绘制路径、矩形、圆形、字符以及添加图像的方法。下面的两行代码绘制一个红色的矩形：<br style="margin: 0px; padding: 0px;"/>//设置fillStyle属性可以是CSS颜色，渐变，或图案。fillStyle 默认设置是#000000（黑色）。<br style="margin: 0px; padding: 0px;"/>//fillRect(x,y,width,height); 定义去腥的填充方式<br style="margin: 0px; padding: 0px;"/>&lt;/script&gt;
</pre></div><h1 style="margin: 10px 0px; padding: 0px; font-size: 28px; font-weight: bold;"><span style="font-family: Helvetica, Verdana, Arial, sans-serif;">打造Canvas粒子动画</span></h1><div style="margin: 10px auto; padding: 0px; text-indent: 0px;"><div><span style="font-size: 14px;"><span style="font-family: Helvetica, Verdana, Arial, sans-serif;">效果：</span></span></div><div><img src="5-粒子 demo1_files/Image.png" type="image/png"/></div><div><img style="margin: 0px; padding: 0px; border: 0px; max-width: 900px; color: rgb(0, 0, 0); font-family: Helvetica, Verdana, Arial, sans-serif; font-size: 14px; font-style: normal; font-variant-ligatures: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: 2; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial;"></img></div></div><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="font-size: 14px;"><span style="font-family: Helvetica, Verdana, Arial, sans-serif;"><img style="margin: 0px; padding: 0px; border: 0px; max-width: 900px;"></img></span></span></p><p style="margin: 10px auto; padding: 0px; text-indent: 0px;"><span style="font-size: 14px;"><span style="font-family: Helvetica, Verdana, Arial, sans-serif;">创建步骤：</span></span></p><div style="margin: 5px 0px; padding: 5px; background-color: rgb(245, 245, 245); border: 1px solid rgb(204, 204, 204); overflow: auto; color: rgb(0, 0, 0); font-family: &quot;Courier New&quot; !important; font-size: 12px !important;"><div style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important;">&lt;canvas id=&quot;myCanvas&quot; width=&quot;900&quot; height=&quot;592&quot;&gt;您的浏览器不支持canvas&lt;/canvas&gt;<br/>
&lt;script&gt;<br/>
    <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">/*</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">*<br/>
     * 参数描述<br/>
     * image:image或者canvas对象<br/>
     * sx,sy 源对象的x,y坐标 可选<br/>
     * sWidth,sHeight 源对象的宽高   可选<br/>
     * dx,dy画布上x,y坐标<br/>
     * dWidth,dHeight 在画布上绘制的宽高  可选<br/>
     * stx.drawImage(image,sx,sy,sWidth,sHeight,dx,dy,dWidth,dHeight);<br/>
     </span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">*/</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);"><br/>
        (</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">function</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">(){<br/>
           </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">var</span> canvas =<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);"> {},<br/>
                image </span>=<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);"> {},<br/>
                ctx </span>= <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">null</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">;<br/>
           </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">var</span> particles =<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);"> [];<br/>
           </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">获取canvas元素</span><br/>
            <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">var</span> canvas = document.getElementById('myCanvas'<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">);<br/><br/>
           </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">if</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">(canvas.getContext) {<br/><br/>
               </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">获取渲染上下文</span><br/>
                ctx = canvas.getContext('2d'<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">);<br/><br/>
               </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">设置画布大小为屏幕宽高</span><br/>
                canvas.w = canvas.width =<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);"> document.body.clientWidth;<br/>
                canvas.h </span>= canvas.height =<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);"> document.body.clientHeight;<br/><br/>
               </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);"> console.log(canvas);</span><br/><br/>
                <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">新建一个image对象</span><br/>
                <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">var</span> img = <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">new</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);"> Image();<br/><br/>
               </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">图像加载完后</span><br/>
                img.onload = <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">function</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">() {<br/>
                   </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">把图像信息保存在image里面</span><br/>
                    image.obj =<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);"> img;<br/>
                    image.w </span>=<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);"> img.width;<br/>
                    image.h </span>=<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);"> img.height;<br/>
                    image.x </span>= parseInt(canvas.w/2 - image.w/2<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">);<br/>
                    image.y </span>= 150<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">;<br/><br/>
                   </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">把图像绘制到画布坐标为(100,100)的地方</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">                    ctx.drawImage(image.obj,image.x,image.y,image.w,image.h);<br/>
                   </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);"> 获取图像的像素信息，并根据像素信息重新绘制出粒子效果轮廓图，canvas有一个叫getImageData的接口，通过该接口可以获取到画布上指定位置的全部像素的数据：</span><br/>
                    image.imageData =<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);"> ctx.getImageData(image.x,image.y,image.w,image.h);<br/>
                     console.log(image.imageData);<br/>
                   </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span> <br/>
                    <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">计算出符合要求的像素</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">                    calculate();<br/><br/>
                   </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">计算后绘到画布上</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">                    draw();<br/>
                };<br/><br/>
               </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">设置image的source</span><br/>
                img.src = 'img/pumpkin_evil.png'<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">;<br/><br/>
            }<br/>
           </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">计算并保存坐标</span><br/>
            <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">function</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);"> calculate() {<br/>
               </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">var</span> len =<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);"> image.imageData.length;<br/>
               </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">只保存100行，100列的像素值</span><br/>
                <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">var</span> cols = 100<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">,<br/>
                    rows </span>= 100<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">;<br/>
               </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">设成150行，100列后每个单元的宽高</span><br/>
                <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">var</span> s_width = parseInt(image.w/cols),   <br/>
                    s_height = parseInt(image.h/rows);<br/>
                <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">var</span> pos = 0; <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">数组中的位置</span><br/>
                <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">var</span> par_x, par_y;  <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">粒子的x,y坐标</span><br/>
                <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">var</span> data = image.imageData.data;  <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">像素值数组</span><br/>
                <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">for</span>(<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">var</span> i = 0; i &lt; cols; i++<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">) {<br/>
                   </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">for</span>(<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">var</span> j = 0; j &lt; rows; j++<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">) {<br/>
                       </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">计算(i,j)在数组中的R的坐标值</span><br/>
                        pos = (j*s_height*image.w + i*s_width)*4<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">;<br/>
                       </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">判断像素透明度值是否符合要求</span><br/>
                        <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">if</span>(data[pos+3] &gt; 100<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">){<br/>
                           </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">var</span> particle =<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);"> {<br/>
                               </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">x,y值都随机一下</span><br/>
                                x: image.x + i*s_width + (Math.random() - 0.5)*20<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">,<br/>
                                y: image.y </span>+ j*s_height + (Math.random() - 0.5)*20<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);"><br/>
                            }<br/>
                           </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);"> 根据图像不同的色值来设定粒子色值</span><br/>
                            <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">if</span>(data[pos+1] &lt; 175 &amp;&amp; data[pos+2] &lt; 10<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">) {<br/>
                                particle.fillStyle </span>= '#ffa900'<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">;<br/>
                            } </span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">else</span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">if</span>(data[pos+1] &lt; 75 &amp;&amp; data[pos+1] &gt; 50<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">) {<br/>
                                particle.fillStyle </span>= '#ff4085'<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">;<br/>
                            } </span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">else</span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">if</span>(data[pos+1] &lt; 220 &amp;&amp; data[pos+1] &gt; 190<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">) {<br/>
                                particle.fillStyle </span>= '#00cfff'<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">;<br/>
                            } </span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">else</span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">if</span>(data[pos+1] &lt; 195 &amp;&amp; data[pos+1] &gt; 175<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">) {<br/>
                                particle.fillStyle </span>= '#9abc1c'<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">;<br/>
                            }<br/>
                           </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">符合要求的粒子保存到数组里</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">                            particles.push(particle);<br/>
                        }<br/>
                    }<br/>
                }<br/>
            }<br/><br/>
           </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">绘图案</span><br/>
            <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">function</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);"> draw() {<br/>
               </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">清空画布                   </span><br/>
                ctx.clearRect(0,0<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">,canvas.w,canvas.h);<br/><br/>
               </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">var</span> len =<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);"> particles.length;<br/>
               </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">var</span> curr_particle = <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">null</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">;<br/><br/>
               </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">for</span>(<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 255);">var</span> i = 0; i &lt; len; i++<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">) {<br/><br/>
                    curr_particle </span>=<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);"> particles[i];<br/><br/>
                   </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">设置填充颜色</span><br/>
                    ctx.fillStyle =<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);"> curr_particle.fillStyle;<br/>
                   </span> <span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">//</span><span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 128, 0);">绘粒子到画布上</span><br/>
                    ctx.fillRect(curr_particle.x,curr_particle.y,1,1<span style="margin: 0px; padding: 0px; font-family: &quot;Courier New&quot; !important; font-size: 12px !important; color: rgb(0, 0, 0);">);<br/>
                }<br/>
            }<br/>
        })()<br/><br/><br/>
   </span> &lt;/script&gt;<br/></div></div></div></div></div></span>
</div></body></html> 