<html>
<head>
  <title>2-Web 前沿——HTML5 Form Data 对象的使用</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/304720 (zh-CN, DDL); Windows/10.0.14393 (Win64);"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1418"/>
<h1>2-Web 前沿——HTML5 Form Data 对象的使用</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2017/3/22 星期三 11:16</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2017/3/22 星期三 11:17</i></td></tr>
<tr><td><b>作者：</b></td><td><i>王平安</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div>Web 前沿——HTML5 Form Data 对象的使用  www.cnblogs.com/lhb25/p/html5-formdata-tutorials.html</div><div><br/></div><div>　　XMLHttpRequest Level 2 添加了一个新的接口——FormData<code>。</code>利用 FormData <code>对象，</code>我们可以通过 <a href="http://www.cnblogs.com/lhb25/category/146074.html" target="_blank"><strong>JavaScript</strong></a> 用一些键值对来模拟一系列表单控件，我们还可以使用 XMLHttpRequest 的 send() 方法来异步的提交表单。与普通的 Ajax 相比，使用 FormData 的最大优点就是我们可以异步上传二进制文件。</div><div><div>您可能感兴趣的相关文章</div><div><ul><li><a href="http://www.cnblogs.com/lhb25/archive/2013/04/11/10-metro-bootstraps-ui-templates.html" target="_blank">10大流行 Metro UI Bootstrap 主题和模板</a></li><li><a href="http://www.cnblogs.com/lhb25/archive/2012/08/08/ajax-jquery-pagination-plugin-tutorial.html" target="_blank">精选12款优秀 jQuery Ajax 分页插件和教程</a></li><li><a href="http://www.cnblogs.com/lhb25/archive/2013/04/11/10-metro-bootstraps-ui-templates.html" target="_blank">10大流行的 Metro UI 风格 Bootstrap 主题</a></li><li><a href="http://www.cnblogs.com/lhb25/archive/2012/10/24/jquery-loading-animation-and-progress-bar-plugins.html" target="_blank">8款效果精美的 jQuery 加载动画和进度条插件</a></li><li><a href="http://www.cnblogs.com/lhb25/archive/2012/08/03/5-creative-html5-and-css3-templates.html" target="_blank">推荐35款精致的 CSS3 和 HTML5 网页模板</a></li></ul></div><p>  </p><h3>创建一个FormData对象</h3><p>　　你可以先创建一个空的 <code>FormData </code>对象,然后使用 <code>append() </code>方法向该对象里添加字段，如下：</p><div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div></td><td><div><code>var</code> <code>oMyForm =</code> <code>new</code> <code>FormData();</code></div><div> </div><div><code>oMyForm.append(</code><code>&quot;username&quot;</code><code>,</code> <code>&quot;Groucho&quot;</code><code>);</code></div><div><code>oMyForm.append(</code><code>&quot;accountnum&quot;</code><code>, 123456);</code> <code>// 数字123456被立即转换成字符串&quot;123456&quot;</code></div><div> </div><div><code>// fileInputElement中已经包含了用户所选择的文件</code></div><div><code>oMyForm.append(</code><code>&quot;userfile&quot;</code><code>, fileInputElement.files[0]);</code></div><div> </div><div><code>var</code> <code>oFileBody =</code> <code>&quot;&lt;a id=&quot;</code><code>a</code><code>&quot;&gt;&lt;b id=&quot;</code><code>b</code><code>&quot;&gt;hey!&lt;/b&gt;&lt;/a&gt;&quot;</code><code>;</code> <code>// Blob对象包含的文件内容</code></div><div><code>var</code> <code>oBlob =</code> <code>new</code> <code>Blob([oFileBody], { type:</code> <code>&quot;text/xml&quot;</code><code>});</code></div><div> </div><div><code>oMyForm.append(</code><code>&quot;webmasterfile&quot;</code><code>, oBlob);</code></div><div> </div><div><code>var</code> <code>oReq =</code> <code>new</code> <code>XMLHttpRequest();</code></div><div><code>oReq.open(</code><code>&quot;POST&quot;</code><code>,</code> <code>&quot;http://foo.com/submitform.php&quot;</code><code>);</code></div><div><code>oReq.send(oMyForm);</code></div></td></tr></tbody></table></div><p><strong>　　注：</strong>字段 &quot;userfile&quot; 和 &quot;webmasterfile&quot; 的值都包含了一个文件。通过 <code><a href="https://developer.mozilla.org/zh-CN/DOM/XMLHttpRequest/FormData#append%28%29" title="zh-CN/XMLHttpRequest/FormData#append()">FormData.append()</a> </code>方法赋给字段 &quot;accountnum&quot; 的数字被自动转换为字符（字段的值可以是一个 <code><a href="https://developer.mozilla.org/zh-CN/docs/DOM/Blob" title="一个Blob对象就是一个包含有只读原始数据的类文件对象.Blob对象中的数据并不一定得是JavaScript中的原生形式.File接口基于Blob,继承了Blob的功能,并且扩展支持了用户计算机上的本地文件.">Blob</a> </code>对象，<a href="https://developer.mozilla.org/zh-CN/docs/DOM/File" title="File 接口提供了文件的信息，以及文件内容的存取方法。"><code>File</code></a>对象或者字符串，剩下其他类型的值都会被自动转换成字符串）。</p><p>　　在该例子中，我们创建了一个名为 oMyForm 的 FormData 对象，该对象中包含了名为&quot;username&quot;，&quot;accountnum&quot;，&quot;userfile&quot; 以及 &quot;webmasterfile&quot; 的字段名，然后使用<code>XMLHttpRequest</code>的 <code><a href="https://developer.mozilla.org/zh-CN/DOM/XMLHttpRequest#send%28%29" title="zh-CN/XMLHttpRequest#send()">send()</a> </code>方法把这些数据发送了出去。&quot;webmasterfile&quot; 字段的值不是一个字符串,还是一个 <code><a href="https://developer.mozilla.org/zh-CN/DOM/Blob" title="zh-CN/DOM/Blob">Blob</a> </code>对象。</p><h3>使用HTML表单来初始化一个FormData对象</h3><p>　　可以用一个已有的 form 元素来初始化 <code>FormData 对象，</code>只需要把这个 <code>form </code>元素作为参数传入 <code>FormData </code>构造函数即可：</p><div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><div>1</div></td><td><div><code>var</code> <code>newFormData =</code> <code>new</code> <code>FormData(someFormElement);</code></div></td></tr></tbody></table></div><p>　　例如：</p><div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><div>1</div><div>2</div><div>3</div><div>4</div></td><td><div><code>var</code> <code>formElement = document.getElementById(</code><code>&quot;myFormElement&quot;</code><code>);</code></div><div><code>var</code> <code>oReq =</code> <code>new</code> <code>XMLHttpRequest();</code></div><div><code>oReq.open(</code><code>&quot;POST&quot;</code><code>,</code> <code>&quot;submitform.php&quot;</code><code>);</code></div><div><code>oReq.send(</code><code>new</code> <code>FormData(formElement));</code></div></td></tr></tbody></table></div><p>　　你还可以在已有表单数据的基础上，继续添加新的键值对，如下：</p><div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><div>1</div><div>2</div><div>3</div><div>4</div></td><td><div><code>var</code> <code>formElement = document.getElementById(</code><code>&quot;myFormElement&quot;</code><code>);</code></div><div><code>formData =</code> <code>new</code> <code>FormData(formElement);</code></div><div><code>formData.append(</code><code>&quot;serialnumber&quot;</code><code>, serialNumber++);</code></div><div><code>oReq.send(formData);</code></div></td></tr></tbody></table></div><p>　　你可以通过这种方式添加一些不想让用户编辑的固定字段,然后再发送.</p><h3>使用FormData对象发送文件</h3><p>　　你还可以使用 <code>FormData </code>来发送二进制文件.首先在 HTML 中要有一个包含了文件输入框的 form 元素：</p><div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div></td><td><div><code>&lt;form enctype=</code><code>&quot;multipart/form-data&quot;</code> <code>method=</code><code>&quot;post&quot;</code> <code>name=</code><code>&quot;fileinfo&quot;</code><code>&gt;</code></div><div><code>  </code><code>&lt;label&gt;Your email address:&lt;/label&gt;</code></div><div><code>  </code><code>&lt;input type=</code><code>&quot;email&quot;</code> <code>autocomplete=</code><code>&quot;on&quot;</code> <code>autofocus name=</code><code>&quot;userid&quot;</code> <code>placeholder=</code><code>&quot;email&quot;</code> <code>required size=</code><code>&quot;32&quot;</code> <code>maxlength=</code><code>&quot;64&quot;</code> <code>/&gt;&lt;br /&gt;</code></div><div><code>  </code><code>&lt;label&gt;Custom file label:&lt;/label&gt;</code></div><div><code>  </code><code>&lt;input type=</code><code>&quot;text&quot;</code> <code>name=</code><code>&quot;filelabel&quot;</code> <code>size=</code><code>&quot;12&quot;</code> <code>maxlength=</code><code>&quot;32&quot;</code> <code>/&gt;&lt;br /&gt;</code></div><div><code>  </code><code>&lt;label&gt;File to stash:&lt;/label&gt;</code></div><div><code>  </code><code>&lt;input type=</code><code>&quot;file&quot;</code> <code>name=</code><code>&quot;file&quot;</code> <code>required /&gt;</code></div><div><code>&lt;/form&gt;</code></div><div><code>&lt;div id=</code><code>&quot;output&quot;</code><code>&gt;&lt;/div&gt;</code></div><div><code>&lt;a href=</code><code>&quot;javascript:sendForm()&quot;</code><code>&gt;Stash the file!&lt;/a&gt;</code></div></td></tr></tbody></table></div><p>　　然后你就可以使用下面的代码来异步的上传用户所选择的文件：</p><div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div><div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div></td><td><div><code>function</code> <code>sendForm() {</code></div><div><code>  </code><code>var</code> <code>oOutput = document.getElementById(</code><code>&quot;output&quot;</code><code>);</code></div><div><code>  </code><code>var</code> <code>oData =</code> <code>new</code> <code>FormData(document.forms.namedItem(</code><code>&quot;fileinfo&quot;</code><code>));</code></div><div> </div><div><code>  </code><code>oData.append(</code><code>&quot;CustomField&quot;</code><code>,</code> <code>&quot;This is some extra data&quot;</code><code>);</code></div><div> </div><div><code>  </code><code>var</code> <code>oReq =</code> <code>new</code> <code>XMLHttpRequest();</code></div><div><code>  </code><code>oReq.open(</code><code>&quot;POST&quot;</code><code>,</code> <code>&quot;stash.php&quot;</code><code>,</code> <code>true</code><code>);</code></div><div><code>  </code><code>oReq.onload =</code> <code>function</code><code>(oEvent) {</code></div><div><code>    </code><code>if</code> <code>(oReq.status == 200) {</code></div><div><code>      </code><code>oOutput.innerHTML =</code> <code>&quot;Uploaded!&quot;</code><code>;</code></div><div><code>    </code><code>}</code> <code>else</code> <code>{</code></div><div><code>      </code><code>oOutput.innerHTML =</code> <code>&quot;Error &quot;</code> <code>+ oReq.status +</code> <code>&quot; occurred uploading your file.&lt;br \/&gt;&quot;</code><code>;</code></div><div><code>    </code><code>}</code></div><div><code>  </code><code>};</code></div><div> </div><div><code>  </code><code>oReq.send(oData);</code></div><div><code>}</code></div></td></tr></tbody></table></div><p>　　你还可以不借助 HTML 表单，直接向 <code><a href="https://developer.mozilla.org/zh-CN/docs/DOM/XMLHttpRequest/FormData" title="XMLHttpRequest Level 2添加了一个新的接口FormData.利用FormData对象,我们可以通过JavaScript用一些键值对来模拟一系列表单控件,我们还可以使用XMLHttpRequest的send()方法来异步的提交这个&quot;表单&quot;.比起普通的ajax,使用FormData的最大优点就是我们可以异步上传一个二进制文件.">FormData</a> </code>对象中添加一个 <code><a href="https://developer.mozilla.org/zh-CN/docs/DOM/File" title="File 接口提供了文件的信息，以及文件内容的存取方法。">File</a> </code>对象或者一个 <code><a href="https://developer.mozilla.org/zh-CN/docs/DOM/Blob" title="一个Blob对象就是一个包含有只读原始数据的类文件对象.Blob对象中的数据并不一定得是JavaScript中的原生形式.File接口基于Blob,继承了Blob的功能,并且扩展支持了用户计算机上的本地文件.">Blob</a> </code>对象：</p><div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><div>1</div></td><td><div><code>data.append(</code><code>&quot;myfile&quot;</code><code>, myBlob);</code></div></td></tr></tbody></table></div><p>　　如果 FormData 对象中的某个字段值是一个 <code><a href="https://developer.mozilla.org/zh-CN/docs/DOM/Blob" title="一个Blob对象就是一个包含有只读原始数据的类文件对象.Blob对象中的数据并不一定得是JavaScript中的原生形式.File接口基于Blob,继承了Blob的功能,并且扩展支持了用户计算机上的本地文件.">Blob</a> </code>对象，则在发送 HTTP 请求时，代表该 <code>Blob </code>对象所包含文件的文件名的 &quot;Content-Disposition&quot; 请求头的值在不同的浏览器下有所不同，Firefox使用了固定的字符串&quot;blob&quot;，而 Chrome 使用了一个随机字符串。</p><p>　　你还可以使用 jQuery 来发送 <code>FormData，但必须要正确的设置相关选项：</code></p><div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div></td><td><div><code>var</code> <code>fd =</code> <code>new</code> <code>FormData(document.getElementById(</code><code>&quot;fileinfo&quot;</code><code>));</code></div><div><code>fd.append(</code><code>&quot;CustomField&quot;</code><code>,</code> <code>&quot;This is some extra data&quot;</code><code>);</code></div><div><code>$.ajax({</code></div><div><code>  </code><code>url:</code> <code>&quot;stash.php&quot;</code><code>,</code></div><div><code>  </code><code>type:</code> <code>&quot;POST&quot;</code><code>,</code></div><div><code>  </code><code>data: fd,</code></div><div><code>  </code><code>processData:</code> <code>false</code><code>, </code> <code>// 告诉jQuery不要去处理发送的数据</code></div><div><code>  </code><code>contentType:</code> <code>false</code>   <code>// 告诉jQuery不要去设置Content-Type请求头</code></div><div><code>});</code></div></td></tr></tbody></table></div><h3>浏览器兼容性</h3><p>　　桌面端：</p><table><tbody><tr><th>Feature</th><th>Chrome</th><th>Firefox (Gecko)</th><th>Internet Explorer</th><th>Opera</th><th>Safari</th></tr><tr><td>Basic support</td><td>7+</td><td>4.0 (2.0)</td><td>10+</td><td>12+</td><td>5+</td></tr><tr><td>支持<code>filename</code>参数</td><td><span title="Please update this with the earliest version of support.">(Yes)</span></td><td>22.0 (22.0)</td><td><span title="Compatibility unknown; please update this.">?</span></td><td><span title="Compatibility unknown; please update this.">?</span></td><td><span title="Compatibility unknown; please update this.">?</span></td></tr></tbody></table><p>　　移动端： </p><table><tbody><tr><th>Feature</th><th>Android</th><th>Chrome for Android</th><th>Firefox Mobile (Gecko)</th><th>IE Mobile</th><th>Opera Mobile</th><th>Safari Mobile</th></tr><tr><td>Basic support</td><td>3.0</td><td><span title="Compatibility unknown; please update this.">?</span></td><td>4.0 (2.0)</td><td><span title="Compatibility unknown; please update this.">?</span></td><td><p>12+</p></td><td><span title="Compatibility unknown; please update this.">?</span></td></tr><tr><td>支持<code>filename</code>参数</td><td><span title="Compatibility unknown; please update this.">?</span></td><td><span title="Compatibility unknown; please update this.">?</span></td><td>22.0 (22.0)</td><td><span title="Compatibility unknown; please update this.">?</span></td><td><span title="Compatibility unknown; please update this.">?</span></td><td><span title="Compatibility unknown; please update this.">?</span></td></tr></tbody></table></div></span>
</div></body></html> 